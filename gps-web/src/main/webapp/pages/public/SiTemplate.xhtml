<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:f="http://java.sun.com/jsf/core">

    <f:view contentType="text/html">
        <h:head>
            <title>
                <ui:insert name="title"></ui:insert>
            </title>
            <link rel="icon" href="#{facesContext.externalContext.requestContextPath}/ressources/images/icon.png"/>
            <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
            <h:outputScript library="primefaces" name="jquery/jquery.js" target="head"/>
            <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/resources/js/PrimeFacesLocales.js"/>
            <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>

             <script type="text/javascript">
                function collapseOpenedRow() {
                    var i = $('.ui-row-toggler.ui-icon-circle-triangle-s').length;
                    if (i == 1) {
                        return;
                    }
                    $('.ui-row-toggler.ui-icon-circle-triangle-s').trigger('click');
                }
            </script>
            <style type="text/css">
                .ui-datatable-center {
                    text-align:center;
                }
                .ui-icon-power:hover{
                    padding: 0;
                    border: 0;
                    background-color: #e33b06;
                }                
                .ui-widget {
                    font-size: 58%;
                }
                .ui-layout-unit {
                    padding: 0;
                }
                .ui-layout-unit {
                    padding: 0;
                }
                .ui-layout-center{
                    padding-right: 5px;
                    border: 0;
                }
                .ui-corner-all {
                    -moz-border-radius: 2px;
                    -webkit-border-radius: 2px;
                    border-radius: 2px;
                }
                .thememenu {
                    overflow: auto;
                    height:300px;
                    width:200px;
                }
                .ui-layout-north {
                    z-index:10 !important;
                    overflow:visible;
                }
                .ui-panelmenu-header{
                    border-radius: 0;
                }
                .ui-layout-north .ui-layout-unit-content {
                    overflow:visible;
                }
                .menugrayblock{
                    width: 100%;
                    background-color: gainsboro;
                    padding: 0;
                    margin-top: 5px;
                    height: 30px;
                }
                .ui-wizard-step-title {
                    float: left;
                    font-size: 11px;
                    margin: 0 3px 0 0;
                    padding: 0.4em;
                }
                .ui-dialog .ui-dialog-titlebar{
                    border: 1px solid rgb(0, 103, 139);
                    border-radius: 0;
                }
                .ui-layout-west{
                    border: 0;
                }
                .fc-event-time, .fc-event-title {
                    font-family: inherit;
                    font-weight: 300;
                    font-size: 8pt;
                }
                .fc-event-time{
                    visibility: hidden;
                }
                .fc-button-month{
                    visibility: hidden;
                }
                .fc-button-agendaWeek{
                    visibility: hidden;
                }
                .fc-button-agendaDay{
                    visibility: hidden;
                }
                .ui-dashboard-column {
                    width:250px;
                    padding: 5px;
                }
                .ui-selectcheckboxmenu-header .ui-chkbox .ui-chkbox-box {
                    visibility: hidden !important;
                }
                .fc-event-time{
                    visibility: hidden !important;
                }
                .ui-panelgrid td,.ui-panelgrid tr{
                    border: 0 none;
                    padding: 1px !important;
                }
                .ui-button{
                    border : 1px solid rgb(0, 103, 139) !important;
                    margin: 1px;
                }
                .ui-widget-header{
                    background: rgb(33, 141, 187);
                }
                .ui-panel,.ui-layout-unit .ui-layout-unit-content{
                    padding: 0 !important;  
                } 
                .ui-carousel .ui-carousel-header {
                    height: 9px;
                    margin: 0 1px;
                    overflow: hidden;
                    padding: 7px 10px 8px;
                }
                .ui-carousel .ui-carousel-footer{
                    height: 6px;
                    margin: 0 1px;
                    overflow: hidden;
                    padding: 7px 10px 8px;
                }
                .avatarColumn{
                }
                #div1{
                    background-color:#080808 !important;
                } 

                .ui-state-hover, .ui-widget-content .ui-state-hover {
                    /*background: #f89406 !important;*/
                }
                .marqued{
                    background: url("#{resource['primefaces-start:images/ui-bg_glass_75_79c9ec_1x400.png']}") repeat-x scroll 50% 50% #79C9EC; border: 1px solid #448DAE; color: #026890; font-weight: normal;
                }
                .ui-overlaypanel{
                    padding: 0 !important;
                }
                table.notifMenu{
                    margin: 5px;
                    padding: 10px;
                    width: 200px;
                }
                #notifItem tr.ui-widget-content:hover{
                    padding: 0;
                    cursor: pointer;
                    background: #F3F3F3 !important;
                    border-bottom: 1px solid #ddd;
                }
                #userDiv tr{
                    border: 1px solid #FFF;
                }
                #userDiv tr:hover{
                    background: rgb(203, 224, 255);
                    border: 1px solid #a6c9e2;
                    cursor: pointer;
                }
                tr.active{
                    background: rgb(33, 141, 187);
                    color: #FFF;
                }

                .checkBox .ui-widget-content .ui-state-default{
                    color: red !important;
                    background: url("#{resource['/images/weekend.png']}") repeat-x scroll 50% 50% ; border: 1px solid #448DAE; color: #026890; font-weight: normal;
                } 

                .checkBox td {
                    color: orange;
                }

                .highlightTableRouge {
                    background-color: #d14 !important;
                    background-image: none !important;
                    color: black !important;
                }
                .highlightTableRowJaune {
                    background-color: #EAAB00 !important;
                    background-image: none !important;
                    color: black !important;
                }

                .highlightTableRowVert {
                    background-color: #62c462 !important;
                    background-image: none !important;
                    color: black !important;
                }

                .checkBoxFerie .ui-widget-content .ui-state-default{
                    color: blue !important;
                    background: url("#{resource['/images/ferie.png']}") repeat-x scroll 50% 50% ; border: 1px solid #448DAE; color: #026890; font-weight: normal;
                } 

                .checkBoxFerie td {
                    color: red;
                }
                .mystyle.ui-datatable .ui-datatable-header{
                    background: #6eac2c url("/si-web/javax.faces.resource/images/ui-bg_gloss-wave_50_6eac2c_500x100.png.xhtml?ln=primefaces-start") 50% 50% repeat-x !important;
                }
                .mystyle.ui-datatable .ui-state-default{
                    background:#6eac2c !important;
                }
                .mystyle.ui-datatable .ui-paginator{
                    background:#6eac2c url("/si-web/javax.faces.resource/images/ui-bg_gloss-wave_50_6eac2c_500x100.png.xhtml?ln=primefaces-start") 50% 50% repeat-x !important;
                }
                .ui-datatable.mystyle th {
                    background: #EAAB00;
                    font-family: verdana;
                    font-size: 1em;
                }
            </style>

        </h:head>

        <h:body>
            <p:idleMonitor timeout="#{sessionExpiredHandlerMb.timeout}">
                <p:ajax event="idle" listener="#{sessionExpiredHandlerMb.idleListener()}"/>
            </p:idleMonitor>

            <p:layout expandTitle="Ouvrir" collapseTitle="Réduire" fullPage="true">
                <p:layoutUnit id="top" position="north" size="50" style="border-bottom: 0;">
                    <h:panelGrid columns="2" width="100%">
                        <h:graphicImage height="45" value="/resources/images/gps.jpg"/>

                        <p:ajaxStatus style="position: absolute; top: 5px ; right: 50%">  
                            <f:facet name="start">  
                                <p:graphicImage width="40" value="/resources/images/loading2.gif"/>   
                            </f:facet>  
                            <f:facet name="complete">  
                                <h:outputText value=""/>  
                            </f:facet>  
                        </p:ajaxStatus>  
                        <h:form id="toolbarForm">
                            <p:toolbar style="padding: 5px; float:right; margin: 10px;border-radius: 5px; position: absolute; top: -14px; right: 10px;border : 1px solid rgb(0, 103, 139);">  
                                <p:toolbarGroup align="right">

                                    <h:graphicImage height="20" style=" max-width: 30px; vertical-align: bottom;background-color: rgb(255, 255, 255);border-radius: 2px; margin-right: 2px;border: 1px solid rgb(0, 103, 139);"  url="#{utilisateurManagedBean.findAvatar(login.connectedUser)}"/>
                                    <p:commandButton type="button" id="btnUser" style="margin-right: 5px;" value="#{login.connectedUser.prenom} #{login.connectedUser.nom}"  ajax="false" onclick="user.show();
                                            return false;"/>  
                                    <p:tooltip for="btnUser" value="#{login.connectedUser.prenom} #{login.connectedUser.nom}"/> 
                                    <h:outputLink type="button" style="margin-right: 5px;" value="#{request.contextPath}/pages/carte/vehicules.xhtml">
                                        <p:button  icon="ui-icon-home" id="homeBtn" style="margin-right: 0"/>
                                    </h:outputLink>
                                    <p:tooltip for="homeBtn" value="Accueil"/>                                    
                                    <h:outputLink type="button" value="#{request.contextPath}/j_spring_security_logout">
                                        <p:button  icon="ui-icon-power" id="logoutBtn" style="margin-right: 0"/>
                                    </h:outputLink>
                                    <p:tooltip for="logoutBtn" value="Déconnexion"/>
                                </p:toolbarGroup>
                            </p:toolbar>
                        </h:form>
                    </h:panelGrid>
                </p:layoutUnit>

                <p:layoutUnit id="westLayoutUnit" position="west" size="260" resizable="false" collapsible="true" header="Menu">

                    <h:form id="menuForm">
                        <ui:include src="/pages/public/menu.xhtml"/>
                    </h:form>
                </p:layoutUnit>

                <p:layoutUnit id="bottom" size="25" position="south" style="position: relative;">
                    <center>
                        <h:outputLink title="Gps" target="Gps" value="http://www.gps.com">Copyright © 2013 - GPS Inc.</h:outputLink>
                    </center>
                    <p:outputLabel style="position:absolute; right:0; bottom:0" value="Version #{versionManagedBean.version} du #{versionManagedBean.versionDate}"/>

                </p:layoutUnit>

                <p:layoutUnit id="center" position="center" style="">
                    <p:layout>
                        <p:layoutUnit position="north" style="width: 100%;height: 5%;border: 0;">
                            <h:form id="formCenter">
                                <p:growl id="messagesGrowl" autoUpdate="true" life="#{messageLifeManagedBean.lifeTime}"/>
                                
                                <p:toolbar>
                                    <p:toolbarGroup>
                                        <h:outputLink  rendered="#{login.nearTimeEntretiens != null}"  style="float: center; color: white" value="#{request.contextPath}/pages/entretiens/entretiens.xhtml">
                                            <h:outputText rendered="#{login.nearTimeEntretiens.size() eq 1}" value="(1) entretien proche"></h:outputText>
                                            <h:outputText rendered="#{login.nearTimeEntretiens.size() gt 1}" value="(#{login.nearTimeEntretiens.size()}) entretiens proches"></h:outputText>
                                        </h:outputLink>
                                        
                                        <ui:insert name="bodybar"/>
                                    </p:toolbarGroup>
                                    <p:toolbarGroup align="right">
                                        
                                        <ui:insert name="bodybarRight"/>
                                        
                                    </p:toolbarGroup>
                                </p:toolbar>
                            </h:form>

                            <p:dialog closeOnEscape="true" header="Information sur l'utilisateur actuel" widgetVar="user" closable="true" resizable="false" appendTo="@(body)" modal="true">
                                <h:form id="formDialog">
                                    <h:panelGrid columns="2">
                                        <h:outputLabel value="Prénom : " for="prenom"/>
                                        <h:outputText value="#{login.connectedUser.prenom}" id="prenom"></h:outputText>
                                        <h:outputLabel value="Nom : " for="nom"/>
                                        <h:outputText value="#{login.connectedUser.nom}" id="nom"></h:outputText>
                                        <p:commandLink onclick="user.hide();" oncomplete="profil.show();" style="margin-right:20px;color: cornflowerblue">  
                                            <h:outputText value="Changement du mot de passe"/>  
                                        </p:commandLink>  
                                        <br/>
                                        <p:commandLink onclick="user.hide();" oncomplete="lifeMessage.show();" style="margin-right:20px;color: cornflowerblue">  
                                            <h:outputText value="Durée des messages de notifications"/>  
                                        </p:commandLink> 
                                    </h:panelGrid>
                                </h:form>
                            </p:dialog>
                            <p:dialog closeOnEscape="true" id="profils" widgetVar="profil" header="Modification du mot de passe" draggable="false" resizable="false" appendTo="@(body)" modal="true">
                                <h:form id="formDialogd">
                                    <h:panelGrid columns="3" id="profilPanel" style="width: 100%">
                                        <h:outputLabel value="Ancien mot de passe : "/>
                                        <p:inputText style="width: 100%;" id="idOldPswd" value="#{login.ancienPassWord}" type="password"  required="true"
                                                     requiredMessage="Mot de passe manquant !!"/>
                                        <p:message for="idOldPswd"/>
                                        <h:outputLabel value="Nouveau mot de passe : "/>
                                        <p:inputText style="width: 100%;" id="newPswd" value="#{login.newPassWord}" type="password"  required="true"
                                                     requiredMessage="Nouveau mot de passe manquant !!"/>
                                        <p:message for="newPswd"/>
                                        <h:outputLabel value="Nouveau mot de passe : "/>
                                        <p:inputText style="width: 100%;" id="confNewPswd" value="#{login.confPassWord}" type="password"  required="true"
                                                     requiredMessage="Nouveau mot de passe manquant !!"/>
                                        <p:message for="confNewPswd"/>
                                    </h:panelGrid>
                                    <p:spacer/>
                                    <p:commandButton value="Valider" update="profilPanel" action="#{login.savePassWord()}" oncomplete="profil.hide();"/>
                                    <p:commandButton value="Annuler" onclick="profil.hide();" type="button" update="profilPanel">
                                        <pe:resetInput for="profilPanel"/>
                                    </p:commandButton>
                                </h:form>
                            </p:dialog>

                            <p:dialog closeOnEscape="true" id="lifem" widgetVar="lifeMessage"  header="Durée d'affichage des notifications" draggable="false" resizable="false" appendTo="@(body)" modal="true">
                                <h:form id="formDialocg">
                                    <h:panelGrid columns="2" id="messagePanel" style="width: 100%">
                                        <p:outputLabel value="Temps d'affichage des messages de notification" for="time"/>
                                        <p:selectOneMenu style="width: 140px;" id="time" value="#{login.connectedUser.growl}" label="Contact">
                                            <!--<f:selectItem itemLabel="Pas de messages" itemValue="0"/>-->
                                            <f:selectItem itemLabel="2s" itemValue="2000"/>
                                            <f:selectItem itemLabel="5s" itemValue="5000"/>
                                            <f:selectItem itemLabel="10s" itemValue="10000"/>
                                            <p:ajax event="change" listener="#{login.saveLifeTimeMessage}" oncomplete="lifeMessage.hide();"/>
                                        </p:selectOneMenu>
                                    </h:panelGrid>
                                </h:form>
                            </p:dialog>
                        </p:layoutUnit>
                        <p:layoutUnit position="center" style="width: 100%;height: 100%;border: 0;">
                            <ui:insert name="body">
                            </ui:insert>
                        </p:layoutUnit>
                    </p:layout>
                </p:layoutUnit>
            </p:layout>
            <ui:insert name="dialogbox"/>
            <script type="text/javascript">
                function handleCenterRequest(xhr, status, args) {
                    if (!args.validationFailed) {
                        profil.hide();
                    }
                }
                $(document).ready(function() {
                    $("#userDiv tr").click(function() {
                        $(this).addClass('active').siblings().removeClass('active');
                    }
                    );
                }
                );
            </script>
        </h:body>
    </f:view>
</html>
